<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../css/weui.min.css">
		<link rel="stylesheet" href="../../css/jquery-weui.min.css">
		<title>出入园报表系统</title>
		<style>
			html {
				height: 100%;
			}
			body {
				margin: 0px;
				padding: 0px;
				height: 100%;
				background:linear-gradient(to bottom,#CBFAF3, #F0F8E3);
				overflow: hidden;
				border: 1px solid rgba(0,0,0,0);
			}
			.header {
				margin: 10% auto 20px;
				color: #555;
			}
			.report-box {
				display: none;
			}
			button {
				border: none;
				margin: 0 auto 20px;
				padding: 0;
				outline-style: none;
				width: 80%;
				height: 80px;
				border-radius: 20px;
				display: block;
				font-size: 21px;
				color: #fff;
			}
			.total-apply {
				background-color: #35B0CF;
			}
			.total-in {
				background-color: #33cabb;
			}
			.total-out {
				background-color: #15c377;
			}
			.current-in {
				background-color: rgba(80, 121, 155, 0.7);
			}
			p {
				text-align: center;
				font-size: 20px;
				margin: 0;
				padding: 0;
				line-height: 36px;
			}
			.date {
				font-size: 24px;
			}
			.weui-loading {
				width: 50px;
				height: 50px;
			}
			#loading {
				display: none;
			}
			.getMsg {
				text-align: center;
			}
			.getMsg a {
				font-size: 22px;
				color: #333;
				text-decoration: underline;
			}
		</style>
	</head>
	<body>
		<div class="header">
			<p class="date"></p>
			<p class="title">出入园区统计</p>
		</div>
		<div class="report-box">
			<button type="button" class="total-apply"></button>
			<button type="button" class="total-in"></button>
			<button type="button" class="total-out"></button>
			<button type="button" class="current-in"></button>
			<div class="getMsg getAllMsg"><a href="district-report.html">查看详情</a></div>
			<div class="getMsg getDetailMsg"><a href="javascript:;">查看详情</a></div>
		</div>
		<div id="loading" class="weui-loadmore">
			<i class="weui-loading"></i>
		</div>
		<script src="../../js/zepto.min.js"></script>
		<script src="../../js/jquery-weui.min.js"></script>
		<script src="../../js/zepto.touch.js"></script>
		<script>
			$(function(){
				// 获取当前日期
				$('.date').html(dateFormat(new Date(), 'yyyy-mm-dd'))
				if (getParam('address')) {
					$('.title').html(getParam('address') + '园区统计')
					$('.getAllMsg').hide()
					$('.getDetailMsg').hide()
				} else {
					$('.getDetailMsg').hide()
				}
				QueryTodaySummaryData()
				function QueryTodaySummaryData() {
					$.ajax({
					  url: 'http://106.3.225.253:8087/api/EntrancePermit/QueryTodaySummaryData',
					  data: {
						 address: getParam('address') || ''
					  },
					  type: 'GET',
					  dataType: 'json',
					  beforeSend: () => {
					    $('#loading').show()
					  },
					  success: (response) => {
						 if (response.result == 1) {
							 var info = JSON.parse(response.info)[0]
							 console.log(response)
							 $('.total-apply').html('昨日申报人数：' + info.TOTALAPPLY)
							 $('.total-in').html('今日入园人数：' + info.TOTALIN)
							 $('.total-out').html('今日出园人数：' + info.TOTALOUT)
							 $('.current-in').html('实时在园人数：' + info.CURRENTIN)
							 $('.report-box').show()
						 } else {
							 $.toast("获取数据失败，请稍后重试")
						 }
						 $('#loading').hide()
					  },
					  error: (xhr, status) => {
							$('#loading').hide()
							$.toast("获取数据失败，请稍后重试")
					  },
					})
				}
			})
			
			var dateFormat = function() {
			    var token = /d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloS]|"[^"]*"|'[^']*'/g,
			        pad = function(val, len) {
			            val = String(val);
			            len = len || 2;
			            while (val.length < len) {
			                val = "0" + val;
			            }
			            return val;
			        },
			        masks = {
			            "default": 'yyyy-mm-dd HH:MM:ss',
			            "shortDate": 'm/d/yy',
			            "shortTime": 'h:MM TT',
			            "mediumTime": 'h:MM:ss TT',
			            "longTime": 'h:MM:ss TT Z',
			            "isoDate": 'yyyy-mm-dd',
			            "isoTime": 'HH:MM:ss',
			            "isoDateTime": 'yyyy-mm-dd\'T\'HH:MM:ss',
			            "isoUtcDateTime": 'UTC:yyyy-mm-dd\'T\'HH:MM:ss\'Z\''
			        };
			
			    return function(date, mask, utc) {
			
			        if (!(date instanceof Date)) {
			            date = new Date(date);
			        }
			
			        if (isNaN(date)) {
			            throw new SyntaxError("invalid date");
			        }
			
			        mask = masks[mask] || mask || masks["default"];
			
			        var _ = utc ? "getUTC" : "get",
			            d = date[_ + "Date"](),
			            D = date[_ + "Day"](),
			            m = date[_ + "Month"](),
			            y = date[_ + "FullYear"](),
			            H = date[_ + "Hours"](),
			            M = date[_ + "Minutes"](),
			            s = date[_ + "Seconds"](),
			            L = date[_ + "Milliseconds"](),
			            o = utc ? 0 : date.getTimezoneOffset(),
			            flags = {
			                d: d,
			                dd: pad(d),
			                m: m + 1,
			                mm: pad(m + 1),
			                yy: String(y).slice(2),
			                yyyy: y,
			                h: H % 12 || 12,
			                hh: pad(H % 12 || 12),
			                H: H,
			                HH: pad(H),
			                M: M,
			                MM: pad(M),
			                s: s,
			                ss: pad(s),
			                l: pad(L, 3),
			                L: pad(L > 99 ? Math.round(L / 10) : L),
			                t: H < 12 ? "a" : "p",
			                tt: H < 12 ? "am" : "pm",
			                T: H < 12 ? "A" : "P",
			                TT: H < 12 ? "AM" : "PM",
			                o: (o > 0 ? "-" : "+") + pad(Math.floor(Math.abs(o) / 60) * 100 + Math.abs(o) % 60, 4),
			                S: ["th", "st", "nd", "rd"][d % 10 > 3 ? 0 : (d % 100 - d % 10 != 10) * d % 10]
			            };
			
			        return mask.replace(token, function($0) {
			            return $0 in flags ? flags[$0] : $0.slice(1, $0.length - 1);
			        });
			    };
			}();
			
			// 获取url参数
			function getParam(name) {
				var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); 
				  var r = window.location.search.substr(1).match(reg); 
				  if (r != null) return decodeURI(r[2]); return null; 
			}
		</script>
	</body>
</html>
