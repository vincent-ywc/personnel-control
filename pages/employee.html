<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>出入园登记</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/weui.min.css">
		<link rel="stylesheet" href="../css/jquery-weui.min.css">
		<style>
			.header {
				height: 46px;
				line-height: 46px;
				background-color: #69c;
				color: #fff;
				text-align: center;
			}
			.content {
				padding: 0 10px;
			}
			.msg-box .weui-cell__hd {
				margin-right: 30px;
			}
			.weui-cells {
				margin-top: 0 !important;
			}
			.weui-label {
				color: #888;
			}
			.req {
				color: red;
				margin-left: 5px;
				font-weight: bold;
			}
			#check-success, #check-error {
				display: none;
			}
			.weui-cell__ft {
				text-align: right;
			}
			.weui-loading {
				width: 50px;
				height: 50px;
			}
			#loading {
				display: none;
			}
		</style>
	</head>
	<body>
		<div class="header">
			<div class="title">进出园区登记表--公司员工</div>
		</div>
		<div class="content">
			<div class="weui-cells weui-cells_form">
			  <div class="weui-cell">
			    <div class="weui-cell__hd"><label class="weui-label">工号</label></div>
			    <div class="weui-cell__bd">
				  <input id="cardIdVal" class="weui-input" type="text" placeholder="请输入工号" required>
			    </div>
				<div class="weui-cell__ft">
				  <button class="weui-vcode-btn" id="get-msg-btn">获取信息</button>
				</div>
			  </div>
			</div>
			<div class="msg-box">
				<div id="check-error">
				    <div class="weui-cell">
						<div class="weui-cell__hd">
						  <label class="weui-label">系统审核结果</label>
						</div>
						<div class="weui-cell__bd">
						  <label><i class="weui-icon-warn weui-icon_msg page-icon" style="font-size: 18px;margin-right: 5px;"></i><span style="color: #fa5151;vertical-align: middle;">系统核准未通过，请联系接口人确认是否预报进园申请</span></label>
						</div>
					</div>
				  </div>
				<div id="check-success">
					<div class="weui-cell">
					    <div class="weui-cell__hd">
					      <label class="weui-label">系统审核结果</label>
					    </div>
					    <div class="weui-cell__bd">
					      <label><i class="weui-icon-success weui-icon_msg page-icon" style="font-size: 18px;margin-right: 5px;"></i><span style="color: #07c160;vertical-align: middle;">系统核准通过，请测温后填写体温数据并提交，感谢配合</span></label>
					    </div>
					  </div>
					<div class="weui-cell">
					    <div class="weui-cell__hd">
					      <label class="weui-label">工号</label>
					    </div>
					    <div class="weui-cell__bd">
					      <label id="EmployeeId"></label>
					    </div>
					  </div>
					<div class="weui-cell">
					    <div class="weui-cell__hd">
					      <label class="weui-label">申报日期</label>
					    </div>
					    <div class="weui-cell__bd">
					      <label id="ApplyDate"></label>
					    </div>
					  </div>
					  <div class="weui-cell">
					    <div class="weui-cell__hd">
					      <label class="weui-label">姓名</label>
					    </div>
					    <div class="weui-cell__bd">
					      <label id="EmployeeName"></label>
					    </div>
					  </div>
					  <div class="weui-cell">
					    <div class="weui-cell__hd">
					      <label class="weui-label">部门</label>
					    </div>
					    <div class="weui-cell__bd">
					      <label id="DeptName"></label>
					    </div>
					  </div>
					  <div class="weui-cell">
					    <div class="weui-cell__hd">
					      <label class="weui-label">班组</label>
					    </div>
					    <div class="weui-cell__bd">
					      <label id="GroupName"></label>
					    </div>
					  </div>
					  <div class="weui-cell">
					    <div class="weui-cell__hd">
					      <label class="weui-label">申请理由</label>
					    </div>
					    <div class="weui-cell__bd">
					      <label id="ApplyReason"></label>
					    </div>
					  </div>
					  <div class="weui-cell">
					    <div class="weui-cell__hd">
					      <label class="weui-label">现场办公理由</label>
					    </div>
					    <div class="weui-cell__bd">
					      <label id="SiteOfficeReason"></label>
					    </div>
					  </div>
					 <div class="weui-cell">
					   <div class="weui-cell__hd">
					     <label class="weui-label">A类工作地点</label>
					   </div>
					   <div class="weui-cell__bd">
					     <label id="OfficeAddress"></label>
					   </div>
					 </div>
					<div class="weui-cell">
					  <div class="weui-cell__hd">
					    <label class="weui-label">是否区域责任人</label>
					  </div>
					  <div class="weui-cell__bd">
					    <label id="IsAreaOwner"></label>
					  </div>
					</div>
					<div class="weui-cell">
					  <div class="weui-cell__hd">
					    <label class="weui-label">责任区域</label>
					  </div>
					  <div class="weui-cell__bd">
					    <label id="ResponsibilityArea"></label>
					  </div>
					</div>
					<div class="weui-cell">
					  <div class="weui-cell__hd">
					    <label class="weui-label">责任区域编号</label>
					  </div>
					  <div class="weui-cell__bd">
					    <label id="ResponsibilityAreaNo"></label>
					  </div>
					</div>
					<div class="weui-cell">
						<div class="weui-cell__hd"><label class="weui-label">备注</label></div>
						<div class="weui-cell__bd">
							<label id="Remark"></label>
						</div>
					</div>
					<div class="weui-cell">
						<div class="weui-cell__hd"><label class="weui-label">测量体温<span class="req">*</span></label></div>
						<div class="weui-cell__bd">
							<input id="animal-heat" class="weui-input" type="number" placeholder="请输入测量体温" required>
						</div>
					</div>
					<div class="weui-btn-area">
					      <a class="weui-btn weui-btn_primary" href="javascript:" id="submit-but">提交</a>
					</div>
				</div>
			</div>
		</div>
		<div id="loading" class="weui-loadmore">
			<i class="weui-loading"></i>
		</div>
		<script src="../js/zepto.min.js"></script>
		<script src="../js/jquery-weui.min.js"></script>
		<script src="../js/zepto.touch.js"></script>
		<script>
			$(function () {
				$('#get-msg-btn').tap(function () {
					if (!$('#cardIdVal').val()) {
						$.toptip('请输入工号', 'error');
					} else {
						$('#animal-heat').val('')
						// 获取信息
						getPersonnelMsg()
					}
				})
				$('#submit-but').tap(function () {
					if (!$('#animal-heat').val()) {
						$.toptip('请输入体温', 'error');
					} else {
						// 保存信息
						SaveEmpEnterInfo()
					}
				})
				
				function getPersonnelMsg() {
					$.ajax({
					  url: 'http://106.3.225.253:8087/api/EntrancePermit/GetEnterPermissionInfo',
					  data: {
						 empID: $('#cardIdVal').val(),
						 type: 1
					  },
					  type: 'GET',
					  dataType: 'json',
					  beforeSend: () => {
					    $('#loading').show()
					  },
					  success: (response) => {
					    var result = response.result
						if (result == 0) {
							// 未审核通过
							$('#check-error').show()
							$('#check-success').hide()
						} else {
							// 审核通过
							var info = JSON.parse(response.info)[0]
							$('#EmployeeId').html(info.EmployeeId)
							$('#ApplyDate').html(info.ApplyDate.slice(0, 10))
							$('#EmployeeName').html(info.EmployeeName)
							$('#DeptName').html(info.DeptName)
							$('#GroupName').html(info.GroupName)
							$('#ApplyReason').html(info.ApplyReason)
							$('#SiteOfficeReason').html(info.SiteOfficeReason)
							$('#OfficeAddress').html(info.OfficeAddress)
							$('#IsAreaOwner').html(info.IsAreaOwner)
							$('#ResponsibilityArea').html(info.ResponsibilityArea)
							$('#ResponsibilityAreaNo').html(info.ResponsibilityAreaNo)
							$('#Remark').html(info.Remark)
							$('#check-success').show()
							$('#check-error').hide()
						}
					  },
					  error: (xhr, status) => {
						$.toast("获取数据失败，请稍后重试")
					  },
					  complete: () => {
					    $('#loading').hide()
					  }
					})
				}
				
				function SaveEmpEnterInfo() {
					$.ajax({
					  url: 'http://106.3.225.253:8087/api/EntrancePermit/SaveEmpEnterInfo',
					  data: {
						 empID: $('#EmployeeId').html(),
						 type: 1,
						 temp: $('#animal-heat').val()
					  },
					  type: 'POST',
					  dataType: 'json',
					  success: (response) => {
					    var result = response.result
						console.log(response)
						if (result === 'ok') {
							$.toast("提交成功", 1000, function() {
							  location.href = 'entrance-result.html?empID=' + $('#EmployeeId').html() + '&type=1'
							});
						} else {
							$.toast("提交失败，请稍后重试")
						}
					  },
					  error: (xhr, status) => {
						$.toast("提交失败，请稍后重试")
					  },
					})
				}
			})
		</script>
	</body>
</html>
